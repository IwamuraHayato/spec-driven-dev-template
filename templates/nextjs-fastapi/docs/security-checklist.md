# セキュリティチェックリスト（IPA準拠）

本チェックリストは IPA（独立行政法人 情報処理推進機構）「安全なウェブサイトの作り方 第7版」に基づいています。
リリース前のセキュリティ確認にご活用ください。

---

## 使い方

各項目について確認し、該当する状態にチェックを入れてください。

- ✅ **対応済**: 対策が実装されている
- ⬜ **未対応**: 対策が必要だが未実装
- ➖ **対象外**: 該当機能がない、または別の方法で対策済み

---

## 1. SQLインジェクション (CWE-89)

| 状態 | チェック項目 | 対策方法 |
|:---:|------------|---------|
| ⬜ | SQL文の組み立てにプレースホルダを使用している | SQLAlchemy ORM または パラメータバインディング |
| ⬜ | ユーザー入力を直接SQL文に連結していない | 文字列フォーマットでのSQL生成を禁止 |
| ⬜ | エラーメッセージにDB情報を含めていない | 一般的なエラーメッセージを返す |
| ⬜ | DBアカウントの権限を最小化している | アプリ用DBユーザーに必要最小限の権限 |

**備考:**
```
（確認日: YYYY/MM/DD、確認者: ）

```

---

## 2. OSコマンド・インジェクション (CWE-78)

| 状態 | チェック項目 | 対策方法 |
|:---:|------------|---------|
| ⬜ | シェルを起動する関数を使用していない | `subprocess.run` は `shell=False` で使用 |
| ⬜ | 外部コマンド実行が必要な場合、引数をリスト形式で渡している | `["cmd", "arg1", "arg2"]` 形式 |
| ⬜ | 可能な限りライブラリを直接使用している | ファイル操作は `open()` 等を使用 |
| ⬜ | 実行を許可するコマンドを限定している | ホワイトリスト方式 |

**備考:**
```
（確認日: YYYY/MM/DD、確認者: ）

```

---

## 3. ディレクトリ・トラバーサル (CWE-22)

| 状態 | チェック項目 | 対策方法 |
|:---:|------------|---------|
| ⬜ | ファイルパスからファイル名のみを抽出している | `os.path.basename()` を使用 |
| ⬜ | 固定のベースディレクトリと結合している | `Path.resolve().relative_to()` で検証 |
| ⬜ | `..` や `/` を含むパスを拒否している | パスの正規化と検証 |
| ⬜ | アップロードディレクトリのパーミッションを適切に設定している | 実行権限を付与しない |

**備考:**
```
（確認日: YYYY/MM/DD、確認者: ）

```

---

## 4. セッション管理の不備 (CWE-384)

| 状態 | チェック項目 | 対策方法 |
|:---:|------------|---------|
| ⬜ | セッションIDは暗号学的に安全な乱数で生成している | `secrets.token_urlsafe(32)` |
| ⬜ | Cookieに `HttpOnly` 属性を設定している | JavaScript からのアクセス防止 |
| ⬜ | Cookieに `Secure` 属性を設定している | HTTPS でのみ送信 |
| ⬜ | Cookieに `SameSite` 属性を設定している | CSRF対策 |
| ⬜ | ログイン成功時にセッションIDを再生成している | セッション固定化攻撃対策 |
| ⬜ | セッションに適切な有効期限を設定している | タイムアウト設定 |

**備考:**
```
（確認日: YYYY/MM/DD、確認者: ）

```

---

## 5. クロスサイト・スクリプティング (CWE-79)

| 状態 | チェック項目 | 対策方法 |
|:---:|------------|---------|
| ⬜ | HTMLに出力する際にエスケープ処理を行っている | React のデフォルトエスケープを活用 |
| ⬜ | `dangerouslySetInnerHTML` を使用する場合はサニタイズしている | DOMPurify を使用 |
| ⬜ | URLに含まれる `javascript:` スキームを拒否している | URLスキームの検証 |
| ⬜ | Content-Type を正しく設定している | `application/json` 等 |
| ⬜ | Content-Security-Policy ヘッダーを設定している | CSP ポリシー |
| ⬜ | X-Content-Type-Options: nosniff を設定している | MIME タイプスニッフィング防止 |

**備考:**
```
（確認日: YYYY/MM/DD、確認者: ）

```

---

## 6. CSRF（クロスサイト・リクエスト・フォージェリ） (CWE-352)

| 状態 | チェック項目 | 対策方法 |
|:---:|------------|---------|
| ⬜ | 状態変更リクエストにCSRFトークンを使用している | POSTリクエストでトークン検証 |
| ⬜ | 重要な操作では再認証を要求している | パスワード再入力 |
| ⬜ | SameSite Cookie を使用している | `SameSite=Lax` または `Strict` |
| ⬜ | Referer/Origin ヘッダーを検証している（保険的対策） | 許可されたオリジンのみ |

**備考:**
```
（確認日: YYYY/MM/DD、確認者: ）

```

---

## 7. HTTPヘッダ・インジェクション (CWE-113)

| 状態 | チェック項目 | 対策方法 |
|:---:|------------|---------|
| ⬜ | HTTPヘッダに外部入力を含める際に改行を除去している | `\r` `\n` の除去 |
| ⬜ | リダイレクトにはフレームワークの機能を使用している | `RedirectResponse` |
| ⬜ | リダイレクト先URLを検証している | ホワイトリスト方式 |

**備考:**
```
（確認日: YYYY/MM/DD、確認者: ）

```

---

## 8. メールヘッダ・インジェクション (CWE-93)

| 状態 | チェック項目 | 対策方法 |
|:---:|------------|---------|
| ⬜ | メールヘッダに外部入力を使用していない、または改行を除去している | To, Subject の検証 |
| ⬜ | メールアドレスの形式を検証している | 正規表現または専用ライブラリ |
| ⬜ | メール送信にはライブラリを使用している | `email.mime` 等 |

**備考:**
```
（確認日: YYYY/MM/DD、確認者: ）

```

---

## 9. クリックジャッキング (CWE-1021)

| 状態 | チェック項目 | 対策方法 |
|:---:|------------|---------|
| ⬜ | X-Frame-Options ヘッダーを設定している | `DENY` または `SAMEORIGIN` |
| ⬜ | Content-Security-Policy の frame-ancestors を設定している | `frame-ancestors 'none'` |
| ⬜ | 重要な操作では再認証を要求している（保険的対策） | 確認ダイアログ + パスワード |

**備考:**
```
（確認日: YYYY/MM/DD、確認者: ）

```

---

## 10. バッファオーバーフロー (CWE-120)

| 状態 | チェック項目 | 対策方法 |
|:---:|------------|---------|
| ⬜ | メモリ安全な言語を使用している | Python, TypeScript |
| ⬜ | 依存ライブラリを定期的に更新している | Dependabot, pip-audit |
| ⬜ | 入力サイズに制限を設けている | ファイルアップロードサイズ制限等 |
| ⬜ | 脆弱性スキャンを定期的に実施している | npm audit, pip-audit |

**備考:**
```
（確認日: YYYY/MM/DD、確認者: ）

```

---

## 11. アクセス制御・認可の不備 (CWE-284)

| 状態 | チェック項目 | 対策方法 |
|:---:|------------|---------|
| ⬜ | すべての保護されたエンドポイントで認証を確認している | 認証ミドルウェア |
| ⬜ | ロールベースのアクセス制御（RBAC）を実装している | `require_role` デコレータ |
| ⬜ | リソースレベルの認可を実装している | 所有者チェック |
| ⬜ | 認可失敗時に適切なエラーレスポンスを返している | 403 Forbidden |
| ⬜ | 管理者機能へのアクセスを制限している | 管理者ロール必須 |

**備考:**
```
（確認日: YYYY/MM/DD、確認者: ）

```

---

## 12. パスワード管理

| 状態 | チェック項目 | 対策方法 |
|:---:|------------|---------|
| ⬜ | パスワードをソルト付きハッシュで保存している | bcrypt, scrypt, Argon2 |
| ⬜ | 平文パスワードを保存・ログ出力していない | ハッシュ化必須 |
| ⬜ | パスワードポリシーを実装している | 長さ、複雑さ要件 |
| ⬜ | パスワードリセット機能が安全に実装されている | 有効期限付きトークン |

**備考:**
```
（確認日: YYYY/MM/DD、確認者: ）

```

---

## 13. 機密情報管理

| 状態 | チェック項目 | 対策方法 |
|:---:|------------|---------|
| ⬜ | 機密情報は環境変数または Secret Manager で管理している | `.env` はローカル開発のみ |
| ⬜ | `.env` ファイルを `.gitignore` に追加している | リポジトリに含めない |
| ⬜ | `.env.example` でテンプレートを提供している | ダミー値のみ |
| ⬜ | APIキーをクライアントサイドに露出していない | サーバーサイドでのみ使用 |

**備考:**
```
（確認日: YYYY/MM/DD、確認者: ）

```

---

## 14. 通信の暗号化

| 状態 | チェック項目 | 対策方法 |
|:---:|------------|---------|
| ⬜ | 本番環境で HTTPS を使用している | SSL/TLS 証明書 |
| ⬜ | HSTS ヘッダーを設定している | `Strict-Transport-Security` |
| ⬜ | HTTP から HTTPS へリダイレクトしている | 301 リダイレクト |
| ⬜ | 古い TLS バージョン（TLS 1.0, 1.1）を無効化している | TLS 1.2 以上 |

**備考:**
```
（確認日: YYYY/MM/DD、確認者: ）

```

---

## 15. ログ・モニタリング

| 状態 | チェック項目 | 対策方法 |
|:---:|------------|---------|
| ⬜ | 認証失敗をログに記録している | ブルートフォース検知 |
| ⬜ | 機密情報をログに出力していない | パスワード、トークン等 |
| ⬜ | ログへのアクセスを制限している | 権限設定 |
| ⬜ | 異常なアクセスパターンを監視している | アラート設定 |

**備考:**
```
（確認日: YYYY/MM/DD、確認者: ）

```

---

## 16. 依存関係のセキュリティ

| 状態 | チェック項目 | 対策方法 |
|:---:|------------|---------|
| ⬜ | 依存関係の脆弱性を定期的にスキャンしている | npm audit, pip-audit |
| ⬜ | セキュリティアラートに迅速に対応している | Dependabot, Snyk |
| ⬜ | 不要な依存関係を削除している | 最小限の依存 |
| ⬜ | ロックファイルをリポジトリに含めている | package-lock.json, requirements.txt |

**備考:**
```
（確認日: YYYY/MM/DD、確認者: ）

```

---

## チェック結果サマリー

| カテゴリ | 対応済 | 未対応 | 対象外 |
|---------|:------:|:------:|:------:|
| 1. SQLインジェクション | /4 | /4 | /4 |
| 2. OSコマンド・インジェクション | /4 | /4 | /4 |
| 3. ディレクトリ・トラバーサル | /4 | /4 | /4 |
| 4. セッション管理 | /6 | /6 | /6 |
| 5. XSS | /6 | /6 | /6 |
| 6. CSRF | /4 | /4 | /4 |
| 7. HTTPヘッダ・インジェクション | /3 | /3 | /3 |
| 8. メールヘッダ・インジェクション | /3 | /3 | /3 |
| 9. クリックジャッキング | /3 | /3 | /3 |
| 10. バッファオーバーフロー | /4 | /4 | /4 |
| 11. アクセス制御・認可 | /5 | /5 | /5 |
| 12. パスワード管理 | /4 | /4 | /4 |
| 13. 機密情報管理 | /4 | /4 | /4 |
| 14. 通信の暗号化 | /4 | /4 | /4 |
| 15. ログ・モニタリング | /4 | /4 | /4 |
| 16. 依存関係 | /4 | /4 | /4 |
| **合計** | /66 | /66 | /66 |

---

## 承認

| 項目 | 内容 |
|-----|------|
| 確認日 | |
| 確認者 | |
| 承認日 | |
| 承認者 | |

---

## 参考文献

- [IPA 安全なウェブサイトの作り方 第7版](https://www.ipa.go.jp/security/vuln/websecurity/)
- [OWASP Top 10](https://owasp.org/www-project-top-ten/)
- [CWE - Common Weakness Enumeration](https://cwe.mitre.org/)
