# コードレビューガイドライン

コードレビューでは不具合を検出できるよう注意深く実装の変更を調べます。
**レビューポイント** に従って、チェックしコメントで指摘してください。

## 技術スタック

- Frontend: Next.js 15+ / TypeScript / Tailwind CSS
- Backend: Python 3.12+ / FastAPI / {{DATABASE_TYPE}}
- Infrastructure: {{INFRASTRUCTURE_PLATFORM}}

## レビューポイント

### ✅ 1. スタイル・可読性

- [ ] 命名が意味を持ち、一貫性がある（変数・関数・クラス名など）
- [ ] 不要な処理・重複コードがない
- [ ] コードが簡潔で読みやすい
- [ ] 適切なインデント・改行・空白が使われている
- [ ] コメントは必要な箇所にあり、意図や背景が明確に書かれている
- [ ] マジックナンバーの使用を避け、定数化されている

---

### ✅ 2. 設計・構造

- [ ] 単一責任の原則（SRP）に従っている
- [ ] 関数やメソッドが適切な長さに保たれている
- [ ] 各モジュールやクラスの役割が明確
- [ ] 再利用性・拡張性を考慮した設計
- [ ] UI・ロジック・データ層などが分離されている
- [ ] Server Component と Client Component が適切に分離されている

---

### ✅ 3. 動作の正確性

- [ ] 要件・仕様に従った動作になっている
- [ ] バグや例外が発生しうる箇所への配慮がある
- [ ] 適切なエラーハンドリング・バリデーションが実装されている
- [ ] 非同期処理における安全性が担保されている
- [ ] エッジケース・境界値の考慮がある

---

### ✅ 4. パフォーマンス

- [ ] 明らかに非効率な処理（重いループや計算）がない
- [ ] 無駄なデータベースアクセスや API リクエストがない
- [ ] UI の再描画や再計算の最適化がされている
- [ ] Next.js の Server Component を活用している
- [ ] 画像最適化（Next.js Image コンポーネント）が適切に使われている

---

### ✅ 5. セキュリティ

- [ ] ユーザー入力のサニタイズ・エスケープができている
- [ ] 認証・認可の処理が適切に実装されている
- [ ] 機密情報が安全に扱われている（環境変数、トークン等）
- [ ] SQL インジェクション対策（ORM の使用）
- [ ] XSS 対策（React のデフォルトエスケープ）
- [ ] CORS 設定が適切

---

### ✅ 6. テスト

- [ ] 単体テスト・結合テストが書かれている
- [ ] 境界値やエラーパターンもテストされている
- [ ] テストの記述が明確かつ読みやすい
- [ ] モック・スタブが適切に使用されている
- [ ] テストカバレッジが {{TEST_COVERAGE_TARGET}}% 以上

---

### ✅ 7. 依存関係・ビルド

- [ ] 不要な依存関係やライブラリが含まれていない
- [ ] バージョン固定・アップデートの管理がされている
- [ ] ビルド・デプロイへの影響が把握されている
- [ ] package.json / requirements.txt が適切に更新されている

---

### ✅ 8. ドキュメント・補足情報

- [ ] README やコメントに補足情報がある（使い方・動作原理など）
- [ ] 環境構築手順や API 仕様などが更新されている
- [ ] 複雑なロジックには適切なコメントがある
- [ ] 型定義が適切に記述されている

---

## Next.js 特有のチェックポイント

### App Router

- [ ] Server Component がデフォルトで使用されている
- [ ] Client Component は `'use client'` ディレクティブが適切に使用されている
- [ ] Route Groups が適切に使用されている
- [ ] Loading UI / Error UI が実装されている

### パフォーマンス

- [ ] Dynamic Rendering / Static Rendering が適切に選択されている
- [ ] Streaming SSR が活用されている
- [ ] Image コンポーネントで最適化されている
- [ ] Font 最適化（next/font）が使用されている

## FastAPI 特有のチェックポイント

### API 設計

- [ ] エンドポイントが RESTful な設計になっている
- [ ] Pydantic スキーマで適切なバリデーション
- [ ] 依存性注入（Depends）が適切に使用されている
- [ ] 非同期関数（async def）が使用されている

### データベース

- [ ] SQLAlchemy の非同期 ORM が使用されている
- [ ] トランザクション管理が適切
- [ ] N+1 問題の考慮
- [ ] マイグレーションファイルが適切

---

## レビューコメントの書き方

### 良いコメント例

```
**指摘**: この関数は責任が多すぎるため、分割を検討してください

**理由**: ユーザー取得、権限チェック、データ変換の3つの責任があります

**提案**: 以下のように分割することを提案します
- getUserById(): ユーザー取得
- checkPermission(): 権限チェック
- transformUserData(): データ変換
```

### 避けるべきコメント例

```
❌ これは良くない
❌ 直してください
❌ 何やってるかわからない
```

---

## レビューの進め方

1. **全体把握**: PR の概要と関連 Issue を確認
2. **変更内容確認**: Diff を確認し、変更の意図を理解
3. **詳細レビュー**: 上記チェックポイントに従ってレビュー
4. **フィードバック**: 建設的なコメントを記載
5. **承認 or 変更要求**: 適切な判断を下す

---

## レビュー承認の基準

- [ ] すべてのチェックポイントをクリアしている
- [ ] CI テストが通過している
- [ ] 破壊的変更がある場合は適切にドキュメント化されている
- [ ] 質問や懸念点が解決されている
